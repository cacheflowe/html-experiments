var TouchObj=Class.create({touchstart:false,touchlast:false,touchmove:false,touchspeed:false,target_point:false,container:false,canvas_drawing:false,touch_id:false,index:false,initialize:function(b,a,c,d){this.container=b;this.index=a;b=10-Math.random()*20;a=10-Math.random()*20;this.touch_id=false;this.touchstart={x:false,y:false};this.touchlast={x:0,y:0};this.touchmove={x:0,y:0};this.touchspeed={x:b,y:a};this.target_point={x:c/2,y:d/2};this.drawDefault()},startTouch:function(){this.drawPressed()},
endTouch:function(){this.touchstart.x=this.touchstart.y=0;this.touchlast.x=this.touchlast.y=0;this.touchmove.x=this.touchmove.y=0;this.touch_id=false;this.drawDefault()},drawDefault:function(){this.container.setOpacity(0.5)},drawPressed:function(){this.container.setOpacity(1)},updatePosition:function(b,a){if(this.touch_id!=false)this.container.style.webkitTransform="translate3d("+this.target_point.x+"px, "+this.target_point.y+"px, 0px)";else{this.touchspeed.x*=0.97;this.touchspeed.y*=0.97;this.target_point.x+=
this.touchspeed.x;this.target_point.y+=this.touchspeed.y;if(this.target_point.x>b-80||this.target_point.x<0){this.touchspeed.x*=-1;this.target_point.x+=this.touchspeed.x}if(this.target_point.y>a-80||this.target_point.y<0){this.touchspeed.y*=-1;this.target_point.y+=this.touchspeed.y}if(Math.abs(this.touchspeed.x)<0.25)this.touchspeed.x=0;if(Math.abs(this.touchspeed.y)<0.25)this.touchspeed.y=0;var c="translate3d("+this.target_point.x+"px, "+this.target_point.y+"px, 0px)";if(this.container.style.webkitTransform!=
c)this.container.style.webkitTransform=c}}}),MultiTouchTracker=Class.create({app_width:0,app_height:0,app_container:false,divs:false,touch_objs:false,timer_fps:1E3/60,touch_id_objs:false,initialize:function(b){this.detectAppSize();this.setBrowserProperties();this.divs=$$(".obj");this.touch_id_objs=[];this.touch_objs=[];for(var a=0;a<this.divs.length;a++){this.touch_objs.push(new TouchObj(this.divs[a],a,this.app_width,this.app_height));this.divs[a].observe("touchstart",this.onStart.bind(this));this.divs[a].observe("touchmove",
this.onMove.bind(this));this.divs[a].observe("touchend",this.onEnd.bind(this));this.divs[a].observe("touchcancel",this.onEnd.bind(this))}this.app_container=b;this.runTimer()},setBrowserProperties:function(){document.ontouchmove=function(b){b.preventDefault()};if(window.orientation!==undefined){window.onorientationchange=function(){window.scrollTo(0,1)};window.onorientationchange(null)}},runTimer:function(){this.detectAppSize();this.app_container.setStyle({width:this.app_width+"px"});this.app_container.setStyle({height:this.app_height+
"px"});for(var b=0;b<this.touch_objs.length;b++)this.touch_objs[b].updatePosition(this.app_width,this.app_height);setTimeout(function(a){a.runTimer()},this.timer_fps,this)},getTouchObjFromEventTarget:function(b){for(var a=0;a<this.touch_objs.length;a++)if(this.touch_objs[a].container==b)return this.touch_objs[a]},getCurrentTouchEvent:function(b){for(var a=0;a<b.touches.length;a++)if(b.touches[a].target==b.target)return b.touches[a]},onStart:function(b){window.scrollTo(0,1);var a=this.getCurrentTouchEvent(b),
c=this.getTouchObjFromEventTarget(b.target);if(c&&a){this.touch_id_objs[a.identifier]=c;c.is_touching=true;c.touchstart.x=a.clientX;c.touchstart.y=a.clientY;c.startTouch()}b.preventDefault()},onMove:function(b){var a=this.getCurrentTouchEvent(b),c=this.touch_id_objs[a.identifier];if(c){c.touchlast.x=c.touchmove.x;c.touchlast.y=c.touchmove.y;c.touchmove.x=a.clientX-c.touchstart.x;c.touchmove.y=a.clientY-c.touchstart.y;c.touchspeed.x=c.touchmove.x-c.touchlast.x;c.touchspeed.y=c.touchmove.y-c.touchlast.y;
c.target_point.x=a.clientX-40;c.target_point.y=a.clientY-40}b.preventDefault()},onEnd:function(b){var a=this.getTouchObjFromEventTarget(b.target);if(a){delete this.touch_id_objs[a.touch_id];a.endTouch()}b.preventDefault()},dispose:function(){for(var b=0;b<this.divs.length;b++){this.divs[b].stopObserving("touchstart");this.divs[b].stopObserving("touchmove");this.divs[b].stopObserving("touchend");this.divs[b].stopObserving("touchcancel")}},detectAppSize:function(){var b=0,a=0;if(typeof window.innerWidth==
"number"){b=window.innerWidth;a=window.innerHeight}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}this.app_width=b;this.app_height=a}});var debug,multitouch;document.observe("dom:loaded",function(){multitouch=new MultiTouchTracker($("page_container"))});Event.observe(window,"load",function(){setTimeout(function(){window.scrollTo(0,1)},500)});

var TouchObj=Class.create({touchstart:false,touchlast:false,touchmove:false,touchspeed:false,target_point:false,container:false,canvas_drawing:false,touch_id:false,index:false,initialize:function(a,b,c,f){this.container=a;this.index=b;var e=10-Math.random()*20;var d=10-Math.random()*20;this.touch_id=false;this.touchstart={x:false,y:false};this.touchlast={x:0,y:0};this.touchmove={x:0,y:0};this.touchspeed={x:e,y:d};this.target_point={x:c/2,y:f/2};this.drawDefault()},startTouch:function(){this.drawPressed()},endTouch:function(){this.touchstart.x=this.touchstart.y=0;this.touchlast.x=this.touchlast.y=0;this.touchmove.x=this.touchmove.y=0;this.touch_id=false;this.drawDefault()},drawDefault:function(){this.container.setOpacity(0.5)},drawPressed:function(){this.container.setOpacity(1)},updatePosition:function(b,c){if(this.touch_id!=false){this.container.style.webkitTransform="translate3d("+this.target_point.x+"px, "+this.target_point.y+"px, 0px)"}else{this.touchspeed.x*=0.97;this.touchspeed.y*=0.97;this.target_point.x+=this.touchspeed.x;this.target_point.y+=this.touchspeed.y;if(this.target_point.x>b-80||this.target_point.x<0){this.touchspeed.x*=-1;this.target_point.x+=this.touchspeed.x}if(this.target_point.y>c-80||this.target_point.y<0){this.touchspeed.y*=-1;this.target_point.y+=this.touchspeed.y}if(Math.abs(this.touchspeed.x)<0.25){this.touchspeed.x=0}if(Math.abs(this.touchspeed.y)<0.25){this.touchspeed.y=0}var a="translate3d("+this.target_point.x+"px, "+this.target_point.y+"px, 0px)";if(this.container.style.webkitTransform!=a){this.container.style.webkitTransform=a}}}});var MultiTouchTracker=Class.create({app_width:0,app_height:0,app_container:false,divs:false,touch_objs:false,timer_fps:1000/60,touch_id_objs:false,initialize:function(b){this.detectAppSize();this.setBrowserProperties();this.divs=$$(".obj");this.touch_id_objs=[];this.touch_objs=[];for(var a=0;a<this.divs.length;a++){this.touch_objs.push(new TouchObj(this.divs[a],a,this.app_width,this.app_height));this.divs[a].observe("touchstart",this.onStart.bind(this));this.divs[a].observe("touchmove",this.onMove.bind(this));this.divs[a].observe("touchend",this.onEnd.bind(this));this.divs[a].observe("touchcancel",this.onEnd.bind(this))}this.app_container=b;this.runTimer()},setBrowserProperties:function(){document.ontouchmove=function(a){a.preventDefault()};if(window.orientation!==undefined){window.onorientationchange=function(a){if(Math.abs(window.orientation)%180===90){window.scrollTo(0,1)}else{window.scrollTo(0,1)}};window.onorientationchange(null)}},runTimer:function(){this.detectAppSize();this.app_container.setStyle({width:this.app_width+"px"});this.app_container.setStyle({height:this.app_height+"px"});for(var a=0;a<this.touch_objs.length;a++){this.touch_objs[a].updatePosition(this.app_width,this.app_height)}setTimeout(function(b){b.runTimer()},this.timer_fps,this)},getTouchObjFromEventTarget:function(b){for(var a=0;a<this.touch_objs.length;a++){if(this.touch_objs[a].container==b){return this.touch_objs[a]}}},getCurrentTouchEvent:function(b){for(var a=0;a<b.touches.length;a++){if(b.touches[a].target==b.target){return b.touches[a]}}},onStart:function(a){window.scrollTo(0,1);var c=this.getCurrentTouchEvent(a);var b=this.getTouchObjFromEventTarget(a.target);if(b&&c){this.touch_id_objs[c.identifier]=b;b.is_touching=true;b.touchstart.x=c.clientX;b.touchstart.y=c.clientY;b.startTouch()}a.preventDefault()},onMove:function(a){var c=this.getCurrentTouchEvent(a);var b=this.touch_id_objs[c.identifier];if(b){b.touchlast.x=b.touchmove.x;b.touchlast.y=b.touchmove.y;b.touchmove.x=c.clientX-b.touchstart.x;b.touchmove.y=c.clientY-b.touchstart.y;b.touchspeed.x=b.touchmove.x-b.touchlast.x;b.touchspeed.y=b.touchmove.y-b.touchlast.y;b.target_point.x=c.clientX-40;b.target_point.y=c.clientY-40}a.preventDefault()},onEnd:function(a){var b=this.getTouchObjFromEventTarget(a.target);if(b){delete this.touch_id_objs[b.touch_id];b.endTouch()}a.preventDefault()},dispose:function(){for(var a=0;a<this.divs.length;a++){this.divs[a].stopObserving("touchstart");this.divs[a].stopObserving("touchmove");this.divs[a].stopObserving("touchend");this.divs[a].stopObserving("touchcancel")}},detectAppSize:function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}this.app_width=b;this.app_height=a}});var debug;var multitouch;document.observe("dom:loaded",function(){multitouch=new MultiTouchTracker($("page_container"))});Event.observe(window,"load",function(){setTimeout(function(){window.scrollTo(0,1)},500)});var Debug=Class.create({element:false,log_lines:10,realtime_properties:[],frame_rate:1000/60,initialize:function(a){this.element=a},log:function(b){var d=new Date();var a=d.getHours();var c=d.getMinutes();if(c<10){c="0"+c}this.element.innerHTML+="<div>["+a+":"+c+"] "+b+"</div>";if(this.element.childElements().length>this.log_lines){this.element.childElements()[0].remove()}},runTimer:function(){$("debug_realtime").innerHTML="";var b;for(var a=0;a<this.realtime_properties.length;a++){b=this.realtime_properties[a];$("debug_realtime").innerHTML+=b.friendlyName+" = "+b.object[b.propertyStr]+"<br/>"}},addRealtimeProperty:function(b,a,c){this.realtime_properties.push({object:b,propertyStr:a,friendlyName:c})}});
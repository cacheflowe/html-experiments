PlatformHelper=function(){this.has_history=this.has_geolocation=this.has_canvas=this.has_prototypejs=this.has_jquery=this.is_chrome=this.is_firefox=this.is_msie8=this.is_msie6=this.is_msie=this.is_touchscreen=this.is_idevice=this.is_android22=this.is_android21=this.is_android=this.animations_enabled=this.webkit_css_enabled=false;this.init()};
PlatformHelper.prototype.init=function(){typeof debug!=="undefined"&&debug.log(navigator.userAgent);if(navigator.userAgent.match(/iPhone/i))this.webkit_css_enabled=true;else if(navigator.userAgent.match(/iPod/i))this.webkit_css_enabled=true;else if(navigator.userAgent.match(/iPad/i))this.webkit_css_enabled=true;else if(navigator.userAgent.match(/Chrome/i))this.webkit_css_enabled=true;else if(navigator.userAgent.match(/Safari/i))this.webkit_css_enabled=true;if(navigator.userAgent.match(/Android/i))this.is_android=
true;if(navigator.userAgent.match(/Android 2.1/i))this.is_android21=true;if(navigator.userAgent.match(/Android 2.2/i))this.is_android22=true;if(navigator.userAgent.match(/MSIE/i))this.is_msie=true;if(navigator.userAgent.match(/MSIE 6/i))this.is_msie6=true;if(navigator.userAgent.match(/MSIE 8/i))this.is_msie8=true;if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))this.is_idevice=true;if(navigator.userAgent.match(/Firefox/i))this.is_firefox=
true;if(navigator.userAgent.match(/Chrome/i))this.is_chrome=true;this.has_jquery=typeof jQuery!=="undefined";this.has_prototypejs=typeof Prototype!=="undefined";this.has_canvas=!!document.createElement("canvas").getContext;this.has_geolocation=!!navigator.geolocation;this.has_history=!!(window.history&&history.pushState);if(this.is_android==true||this.is_idevice==true)this.is_touchscreen=true};
PlatformHelper.prototype.update2DPosition=function(a,b,c){if(a)if(!this.webkit_css_enabled||this.is_android22){a.style.left=b+"px";a.style.top=c+"px"}else{a.style.webkitTransition="";a.style.webkitTransform="";b="translate3d("+b+"px, "+c+"px, 0px)";if(a.style.webkitTransform!=b)a.style.webkitTransform=b}};
PlatformHelper.prototype.updatePositionAndRotation=function(a,b,c,d){if(a)if(!this.webkit_css_enabled||this.is_android22){a.style.left=b+"px";a.style.top=c+"px";a.style.MozTransform="rotate("+d+"deg)";a.style.webkitTransform="rotate("+d+"deg)"}else{b="translate3d("+b+"px, "+c+"px, 0px) rotate("+d+"deg)";if(a.style.webkitTransform!=b)a.style.webkitTransform=b}};
PlatformHelper.prototype.animate2DPosition=function(a,b,c,d){if(a)if(!this.webkit_css_enabled||this.is_android22)$(a).animate({left:b,top:c},d*1E3);else{a.style.left=a.style.top="0px";a.style.webkitTransition="-webkit-transform "+d+"s";b="translate3d("+b+"px, "+c+"px, 0px)";if(a.style.webkitTransform!=b)a.style.webkitTransform=b}};PlatformHelper.prototype.convertPosToWebkitTransform=function(a){if(a)if(this.webkit_css_enabled){a.style.left=0;a.style.top=0}};
PlatformHelper.prototype.copyLink=function(a){window.clipboardData&&clipboardData.setData&&clipboardData.setData("Text",a)};function MouseAndTouchTracker(a,b,c){this.container_position={x:0,y:0};this.touchstart={x:0,y:0};this.touchcurrent={x:0,y:0};this.touchmovedlast={x:0,y:0};this.touchmoved={x:0,y:0};this.touchspeed={x:0,y:0};this.touch_is_inside=this.has_moved=this.is_touch_capable=this.is_touching=false;this.container=a;this.delegate=b;this.is_mouseup_tracking=c;var d=this;this.startFunction=function(e){d.onStart(e)};this.moveFunction=function(e){d.onMove(e)};this.endFunction=function(e){d.onEnd(e)};this.endDocumentFunction=
function(e){if(d.is_touching)d.onEnd(e)};this.container.attachEvent?this.container.attachEvent("onmousedown",this.startFunction):this.container.addEventListener("mousedown",this.startFunction,false);this.container.attachEvent?this.container.attachEvent("onmouseup",this.endFunction):this.container.addEventListener("mouseup",this.endFunction,false);document.attachEvent?document.attachEvent("onmouseup",this.endDocumentFunction):document.addEventListener("mouseup",this.endDocumentFunction,false);document.attachEvent?
document.attachEvent("onmousemove",this.moveFunction):document.addEventListener("mousemove",this.moveFunction,false);if(!this.container.attachEvent){this.container.addEventListener("touchstart",this.startFunction,false);this.container.addEventListener("touchend",this.endFunction,false);this.container.addEventListener("touchcancel",this.endFunction,false);document.addEventListener("touchmove",this.moveFunction,false);document.addEventListener("touchend",this.endDocumentFunction,false)}!this.is_mouseup_tracking&&
!navigator.userAgent.match(/Android/i)&&this.recurseDisableElements(this.container)}MouseAndTouchTracker.state_start="TOUCH_START";MouseAndTouchTracker.state_move="TOUCH_MOVE";MouseAndTouchTracker.state_end="TOUCH_END";MouseAndTouchTracker.state_enter="TOUCH_ENTER";MouseAndTouchTracker.state_leave="TOUCH_LEAVE";
MouseAndTouchTracker.prototype.recurseDisableElements=function(a){if(a){try{a.onmousedown=function(){return false};a.onselectstart=function(){return false}}catch(b){}if(a.childNodes.length>0)for(var c=0;c<a.childNodes.length;c++)this.recurseDisableElements(a.childNodes[c])}};
MouseAndTouchTracker.prototype.disposeTouchListeners=function(){this.container.removeEventListener("touchstart",this.startFunction,false);this.container.removeEventListener("touchend",this.endFunction,false);this.container.removeEventListener("touchcancel",this.endFunction,false);document.removeEventListener("touchmove",this.moveFunction,false);document.removeEventListener("touchend",this.endDocumentFunction,false)};
MouseAndTouchTracker.prototype.disposeMouseListeners=function(){this.container.attachEvent?this.container.detachEvent("onmousedown",this.startFunction):this.container.removeEventListener("mousedown",this.startFunction);this.container.attachEvent?this.container.detachEvent("onmouseup",this.endFunction):this.container.removeEventListener("mouseup",this.endFunction);document.attachEvent?document.detachEvent("onmouseup",this.endDocumentFunction):document.removeEventListener("mouseup",this.endDocumentFunction);
document.attachEvent?document.detachEvent("onmousemove",this.moveFunction):document.removeEventListener("mousemove",this.moveFunction)};
MouseAndTouchTracker.prototype.onStart=function(a){navigator.userAgent.match(/Android/i)&&a.preventDefault();this.findPos(this.container);if(typeof a.touches!=="undefined"){this.is_touch_capable=true;this.disposeMouseListeners()}this.touch_is_inside=this.is_touching=true;if(!this.is_mouseup_tracking){this.touchstart.x=this.is_touch_capable?a.touches[0].clientX:a.clientX;this.touchstart.y=this.is_touch_capable?a.touches[0].clientY:a.clientY;this.touchstart.x-=this.container_position.x;this.touchstart.y-=
this.container_position.y;this.touchcurrent.x=this.touchstart.x;this.touchcurrent.y=this.touchstart.y;this.touchmoved.x=0;this.touchmoved.y=0;this.touchspeed.x=0;this.touchspeed.y=0}this.delegate&&this.delegate.touchUpdated(MouseAndTouchTracker.state_start,a)};
MouseAndTouchTracker.prototype.onMove=function(a){this.findPos(this.container);this.touchmovedlast.x=this.touchmoved.x;this.touchmovedlast.y=this.touchmoved.y;this.touchcurrent.x=this.is_touch_capable?a.touches[0].clientX:a.clientX;this.touchcurrent.y=this.is_touch_capable?a.touches[0].clientY:a.clientY;this.touchcurrent.x-=this.container_position.x;this.touchcurrent.y-=this.container_position.y;this.touchmoved.x=this.touchcurrent.x-this.touchstart.x;this.touchmoved.y=this.touchcurrent.y-this.touchstart.y;
this.touchspeed.x=this.touchmoved.x-this.touchmovedlast.x;this.touchspeed.y=this.touchmoved.y-this.touchmovedlast.y;if(this.is_touching||this.is_mouseup_tracking)this.delegate&&this.delegate.touchUpdated(MouseAndTouchTracker.state_move,a);if(this.touchcurrent.x<0||this.touchcurrent.x>this.container.offsetWidth||this.touchcurrent.y<0||this.touchcurrent.y>this.container.offsetHeight){if(this.touch_is_inside)this.onLeave();this.touch_is_inside=false}else{if(!this.touch_is_inside)this.onEnter();this.touch_is_inside=
true}};MouseAndTouchTracker.prototype.onEnd=function(a){this.delegate&&this.delegate.touchUpdated(MouseAndTouchTracker.state_end,a);this.is_touching=false;if(!this.is_mouseup_tracking){this.touchstart.x=this.touchstart.y=0;this.touchmovedlast.x=this.touchmovedlast.y=0;this.touchmoved.x=this.touchmoved.y=0;this.touchspeed.x=this.touchspeed.y=0}};
MouseAndTouchTracker.prototype.onEnter=function(){this.touchmoved.x=0;this.touchmoved.y=0;this.touchstart.x=this.touchcurrent.x;this.touchstart.y=this.touchcurrent.y;this.delegate&&this.delegate.touchUpdated(MouseAndTouchTracker.state_enter,null)};MouseAndTouchTracker.prototype.onLeave=function(){this.delegate&&this.delegate.touchUpdated(MouseAndTouchTracker.state_leave,null)};
MouseAndTouchTracker.prototype.dispose=function(){this.is_touch_capable?this.disposeTouchListeners():this.disposeMouseListeners();this.touchmoved=this.touchmovedlast=this.touchstart=this.delegate=false};
MouseAndTouchTracker.prototype.findPos=function(a){var b=window.pageXOffset?window.pageXOffset:document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,c=window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,d=curtop=0;if(a.offsetParent){do{if(typeof a.parentNode.style!=="undefined"&&typeof a.parentNode.style.webkitTransform!=="undefined"&&a.parentNode.style.webkitTransform){var e=
a.parentNode.style.webkitTransform.split("translate3d(")[1].split(")")[0].replace(/ +/g,"").replace(/px+/g,"").split(",");d+=parseInt(e[0]);curtop+=parseInt(e[1])}d+=a.offsetLeft;curtop+=a.offsetTop}while(a=a.offsetParent)}this.container_position.x=d-b;this.container_position.y=curtop-c};function ButtonTouchCallback(a,b,c){this.element=a;this.callback=b;this.highlights_on_touch=c||true;this.started_touching=false;this.CANCEL_THRESHOLD=3;this.touch_tracker=new MouseAndTouchTracker(this.element,this)}
ButtonTouchCallback.prototype.touchUpdated=function(a,b){if(a==MouseAndTouchTracker.state_start){if(this.highlights_on_touch)this.element.style.opacity=0.85;this.started_touching=true}if(a==MouseAndTouchTracker.state_move)if(Math.abs(this.touch_tracker.touchmoved.x)+Math.abs(this.touch_tracker.touchmoved.y)>=2)if(this.highlights_on_touch)this.element.style.opacity=1;if(a==MouseAndTouchTracker.state_end){if(this.highlights_on_touch)this.element.style.opacity=1;Math.abs(this.touch_tracker.touchmoved.x)+
Math.abs(this.touch_tracker.touchmoved.y)<3&&this.started_touching&&this.callback(this.element,b);this.started_touching=false}};ButtonTouchCallback.prototype.deactivateHighlight=function(){this.highlights_on_touch=false};ButtonTouchCallback.prototype.dispose=function(){this.touch_tracker&&this.touch_tracker.dispose();delete this.touch_tracker;delete this.callback;delete this.element};function ColorUtil(){}ColorUtil.rgbToHex=function(a,b,c){return a<<16|b<<8|c};ColorUtil.hexToRGB=function(a){var b=a>>16;a-=b<<16;var c=a>>8;return{r:b,g:c,b:a-(c<<8)}};ColorUtil.randomColor=function(){return"#"+Math.floor(Math.random()*16777215).toString(16)};function MathUtil(){}MathUtil.randRangeDecimel=function(a,b){return Math.random()*(b-a)+a};MathUtil.getPercentWithinRange=function(a,b,c){if(a<0){var d=Math.abs(a);a+=d;b+=d;c+=d}else if(a>0){d=Math.abs(a);a-=d;b-=d;c-=d}return c/(b-a)};MathUtil.getDistance=function(a,b){return Math.abs(Math.sqrt(a*a+b*b))};MathUtil.easeTo=function(a,b,c){return a-(a-b)/c};MathUtil.degreesToRadians=function(a){return a*(Math.PI/180)};MathUtil.radiansToDegrees=function(a){return a*(180/Math.PI)};
MathUtil.percentToDegrees=function(a){return Math.abs(a/100)*36E3};MathUtil.degreesToPercent=function(a){return Math.abs(a/360)};MathUtil.randRange=function(a,b){return Math.round(Math.random()*(b-a))+a};MathUtil.sums=function(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=a[d];return b};MathUtil.average=function(a){return sums(a)/a.length};MathUtil.interp=function(a,b,c){return(b-a)*c+a};MathUtil.remap=function(a,b,c,d,e){return MathUtil.interp(d,e,MathUtil.getPercentWithinRange(b,c,a)/100)};
